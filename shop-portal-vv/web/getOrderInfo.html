<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=9; IE=8; IE=7; IE=EDGE">
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <title>结算页</title>
    <link rel="stylesheet" href="/jsp/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/jsp/shop/css/webbase.css" />
    <link rel="stylesheet" type="text/css" href="/jsp/shop/css/pages-getOrderInfo.css" />
    <link rel="stylesheet" href="/jsp/DataTables/css/dataTables.bootstrap.min.css"/>
    <link rel="stylesheet" href="/jsp/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css"/>
    <link rel="stylesheet" href="/jsp/fileinput5/css/fileinput.css"/>
    <link rel="stylesheet" type="text/css" href="/jsp/shop/css/pages-JD-index.css" />
    <link rel="stylesheet" type="text/css" href="/jsp/shop/css/widget-jquery.autocomplete.css" />
    <link rel="stylesheet" type="text/css" href="/jsp/shop/css/widget-cartPanelView.css" />
</head>
<body>
<!--导航条-->
<div id="navId"></div>

<div class="cart py-container" >
    <div class="allgoods">
        <div class="cart-item-list"  id="orderDivId">

        </div>
        <div class="clearfix"></div>
    </div>
</div>

<div class="cart py-container">
    <!--logoArea-->
    <div class="logoArea">
        <div class="fl logo"><span class="title">结算页</span></div>
        <div class="fr search">
            <form class="sui-form form-inline">
                <div class="input-append">
                    <input type="text" type="text" class="input-error input-xxlarge" placeholder="随心所欲" />
                    <button class="sui-btn btn-xlarge btn-danger" type="button">搜索</button>
                </div>
            </form>
        </div>
    </div>
    <!--主内容-->
    <div class="checkout py-container">
        <div class="checkout-tit">
            <h4 class="tit-txt">填写并核对订单信息</h4>
        </div>
        <div class="checkout-steps">
            <!--收件人信息-->
            <div class="step-tit">
                <h5>收件人信息<span><a href="#" onclick="addAddress()">新增收货地址</a></span></h5>
            </div>
            <div class="step-cont">
                <div class="addressInfo">
                    <ul class="addr-detail">
                        <li class="addr-item">
                            <div id="addressDiv">

                            </div>
                        </li>
                    </ul>
                </div>
                <div class="hr"></div>
            </div>
            <div class="hr"></div>
            <!--支付和送货-->
            <div class="payshipInfo">
                <div class="step-tit">
                    <h5>支付方式</h5>
                </div>
                <div class="step-cont">
                    <ul class="payType">
                            <li ><input type="radio" value="10" name="payType" class="selected" >微信付款<span title="点击取消选择"></span></li>
                            <li><input type="radio" value="20" name="payType">支付宝付款<span title="点击取消选择"></span></li>
                    </ul>
                </div>
                <div class="hr"></div>
                <div class="step-tit">
                    <h5>送货清单</h5>
                </div>
                <div class="step-cont">
                    <ul class="send-detail">
                        <li>
                            <div class="sendGoods" id="orderInfoDiv">



                            </div>
                        </li>
                    </ul>
                </div>
                <div class="hr"></div>
            </div>
            <div class="linkInfo">
                <div class="step-tit">
                    <h5>是否打印发票信息</h5>
                </div>
                <div class="step-cont">
                    <ul class="payType">
                        <li><input type="radio" value="1" name="isBill">是<span title="点击取消选择"></span></li>
                        <li><input type="radio" value="2" name="isBill">否<span title="点击取消选择"></span></li>
                    </ul>
                </div>
            </div>
            <div class="cardInfo">
                <div class="step-tit">
                    <h5>使用优惠/抵用</h5>
                </div>
            </div>
        </div>
    </div>
    <div class="order-summary" id="initPriceDiv"></div>
   <div id="rightDlog">


   </div>
    <div class="submit">
        <a class="sui-btn btn-danger btn-xlarge"  onclick="submitPay()">提交订单</a>
    </div>
</div>
<!-- 底部栏位 -->
<!--页面底部-->
<div class="clearfix footer">
    <div class="py-container">
        <div class="footlink">
            <div class="Mod-service">
                <ul class="Mod-Service-list">
                    <li class="grid-service-item intro  intro1">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item  intro intro2">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item intro  intro3">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item  intro intro4">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                    <li class="grid-service-item intro intro5">

                        <i class="serivce-item fl"></i>
                        <div class="service-text">
                            <h4>正品保障</h4>
                            <p>正品保障，提供发票</p>
                        </div>

                    </li>
                </ul>
            </div>
            <div class="clearfix Mod-list">
                <div class="yui3-g">
                    <div class="yui3-u-1-6">
                        <h4>购物指南</h4>
                        <ul class="unstyled">
                            <li>购物流程</li>
                            <li>会员介绍</li>
                            <li>生活旅行/团购</li>
                            <li>常见问题</li>
                            <li>购物指南</li>
                        </ul>

                    </div>
                    <div class="yui3-u-1-6">
                        <h4>配送方式</h4>
                        <ul class="unstyled">
                            <li>上门自提</li>
                            <li>211限时达</li>
                            <li>配送服务查询</li>
                            <li>配送费收取标准</li>
                            <li>海外配送</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>支付方式</h4>
                        <ul class="unstyled">
                            <li>货到付款</li>
                            <li>在线支付</li>
                            <li>分期付款</li>
                            <li>邮局汇款</li>
                            <li>公司转账</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>售后服务</h4>
                        <ul class="unstyled">
                            <li>售后政策</li>
                            <li>价格保护</li>
                            <li>退款说明</li>
                            <li>返修/退换货</li>
                            <li>取消订单</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>特色服务</h4>
                        <ul class="unstyled">
                            <li>夺宝岛</li>
                            <li>DIY装机</li>
                            <li>延保服务</li>
                            <li>品优购E卡</li>
                            <li>品优购通信</li>
                        </ul>
                    </div>
                    <div class="yui3-u-1-6">
                        <h4>帮助中心</h4>
                        <img src="img/wx_cz.jpg">
                    </div>
                </div>
            </div>
            <div class="Mod-copyright">
                <ul class="helpLink">
                    <li>关于我们<span class="space"></span></li>
                    <li>联系我们<span class="space"></span></li>
                    <li>关于我们<span class="space"></span></li>
                    <li>商家入驻<span class="space"></span></li>
                    <li>营销中心<span class="space"></span></li>
                    <li>友情链接<span class="space"></span></li>
                    <li>关于我们<span class="space"></span></li>
                    <li>营销中心<span class="space"></span></li>
                    <li>友情链接<span class="space"></span></li>
                    <li>关于我们</li>
                </ul>
            </div>
        </div>
    </div>
</div>


<!--送货清单-->
<div id="orderInfoId" style="display: none">
    <ul class="yui3-g">
        <li class="yui3-u-1-6">
            <span><img src="##image##"/></span>
        </li>
        <li class="yui3-u-7-12">
            <div class="desc">##shopName##</div>
            <div class="seven">7天无理由退货</div>
        </li>
        <li class="yui3-u-1-12">
            <div class="price">￥##subTotalPrice##</div>
        </li>
        <li class="yui3-u-1-12">
            <div class="num">X##count##</div>
        </li>
        <li class="yui3-u-1-12">
            <div class="exit">有货</div>
        </li>
    </ul>
</div>
<!--价格-->
<div id="initPriceId" style="display: none">
    <div class="static fr">
        <div class="list">
            <span><i class="number">##totalCount##</i>件商品，总商品金额</span>
            <em class="allprice">¥##totalPrice##</em>
        </div>
        <div class="list">
            <span>返现：</span>
            <em class="money">0.00</em>
        </div>
        <div class="list">
            <span>运费：</span>
            <em class="transport">0.00</em>
        </div>
    </div>
</div>
<!--新增地址-->
<div id="addAddressDiv" style="display: none">
    <form class="form-horizontal"  id="resultFrom">
        <div class="form-group">
            <label  class="col-sm-2 control-label" >用户名</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="vipName"  placeholder="请输入用户名....">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label" >收货人电话</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="addresseePhone"  placeholder="请输入收货人电话....">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label" >收货人姓名</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="addresseeName"  placeholder="请输入收货人姓名....">
            </div>
        </div>
        <div class="form-group" id="add_area">
            <label  class="col-sm-2 control-label" >地区</label>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label" >详细地址</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="addressee"  placeholder="请输入详细地址....">
            </div>
        </div>
    </form>
</div>
<!--修改地址-->
<div id="updateAddressDiv" style="display: none">
    <form class="form-horizontal" >
        <div class="form-group">
            <label  class="col-sm-2 control-label" >用户名</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="update_vipName"  placeholder="请输入用户名....">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label" >收货人电话</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="update_addresseePhone"  placeholder="请输入收货人电话....">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label" >收货人姓名</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="update_addresseeName"  placeholder="请输入收货人姓名....">
            </div>
        </div>
        <div class="form-group">
            <label  class="col-sm-2 control-label" >详细地址</label>
            <div class="col-sm-4">
                <input type="text" class="form-control" id="update_addressee"  placeholder="请输入详细地址....">
            </div>
        </div>
        <div class="form-group" id="update_area">
            <label  class="col-sm-2 control-label" >地区</label>
        </div>
    </form>
</div>
<!--地址-->
<div id="initAddressDiv" style="display: none">
    <div class="con name selected"><a href="javascript:;" >##vipName##<span title="点击取消选择"></span></a></div>
    <div class="con address">##vipName##  ##areaName##
        <span>##addresseePhone##</span>
        <!--<span class="base">默认地址</span>-->
        <span class="edittext"><a data-toggle="modal" data-target=".edit" data-keyboard="false" onclick="update('##addressId##')">编辑</a>&nbsp;&nbsp;
            <a href="javascript:;" onclick="del('##addressId##')">删除</a></span>
    </div>
    <div class="clearfix"></div>
</div>
<!--确定信息-->
<div id="rightDiv" style="display:none;">
    <div class="clearfix trade" >
        <div class="fc-price">应付金额:<span class="price" id="totalPriceId">¥</span></div>
        <div class="fc-receiverInfo">寄送至:##areaName## 收货人：##vipName## ##addresseePhone##</div>
    </div>
</div>

<!--无货信息-->
<div id="orderInfo" style="display: none">
    <div class="cart py-container" >
        <div class="allgoods">
            <div class="cart-item-list"  >
                <ul class="yui3-g">
                    <li class="yui3-u-1-6">
                        <span><img src="##image##"/></span>
                    </li>
                    <li class="yui3-u-7-12">
                        <div class="desc">##shopName##</div>
                        <div class="seven">7天无理由退货</div>
                    </li>
                    <li class="yui3-u-1-12">
                        <div class="price">￥##subTotalPrice##</div>
                    </li>
                    <li class="yui3-u-1-12">
                        <div class="num">X##count##</div>
                    </li>
                    <li class="yui3-u-1-12">
                        <div class="exit">无货</div>
                    </li>
                </ul>
            </div>
            <div class="clearfix"></div>
        </div>
    </div>
</div>
<script src="/jsp/jquery-3.3.1.js"></script>
<script src="/jsp/nav.js"></script>
<script src="/jsp/jquery.cookie.min.js"></script>
<script src="/jsp/DataTables/js/jquery.dataTables.min.js"></script>
<script src="/jsp/DataTables/js/dataTables.bootstrap.min.js"></script>
<script src="/jsp/bootstrap/js/bootstrap.min.js"></script>
<script src="/jsp/bootbox/bootbox.min.js"></script>
<script src="/jsp/bootbox/bootbox.locales.min.js"></script>
<script src="/jsp/bootstrap-datetimepicker/js/moment-with-locales.js"></script>
<script src="/jsp/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="/jsp/fileinput5/js/fileinput.js"></script>
<script src="/jsp/fileinput5/js/locales/zh.js"></script>
<script src="/jsp/bootstrap-select/js/bootstrap-select.js"></script>
<script src="/jsp/bootstrap-select/js/i18n/defaults-zh_CN.js"></script>
<script src="/jsp/zTree/js/jquery.ztree.all.min.js"></script>
<script type="text/javascript" src="/jsp/shop/js/pages/getOrderInfo.js"></script>


<script>
    $(function(){
        /*判断用户是否登录*/
        if(!loginFlag){
            $("#orderDivId").html("<div style='text-align: center;font-size: 30px'><li>您还没有登录，<a href='/denglu.html'>登录          </a>或<a href='login.html'>        注册</a></li></div>");
        }else{
            /*购物车模版拼接*/
            initQueryList();
            initcopy();
            queryAddress();
            createToken();
        }
    })
    /*购物车模版拼接*/
    function  initQueryList(){
        $.post({
            url:"http://localhost:8082/carts/initQueryList.jhtml",
            success:function(result){
                if(result.code==200){
                    var v_list=result.data.cartItemList;
                    var v_orderId=$("#orderInfoId").html();
                    var v_html="";
                    for(var i=0;i<v_list.length;i++){
                        var cart=v_list[i];
                         v_html += v_orderId.replace(/##shopName##/g,cart.shopName)
                            .replace(/##price##/g,cart.price)
                            .replace(/##imgPaths##/g,cart.image)
                            .replace(/##subTotalPrice##/g,cart.subTotalPrice)
                            .replace(/##count##/g,cart.count);
                    }
                    $("#orderInfoDiv").html(v_html);
                    //结算价格
                    var v_initPriceId=$("#initPriceId").html();
                    var v_price=v_initPriceId.replace(/##totalCount##/g,result.data.totalCount).replace(/##totalPrice##/g,result.data.totalPrice);
                    $("#initPriceDiv").html(v_price);
                    $("#totalPriceId").html(result.data.totalPrice);
                }else if(result.code==1017){
                    $("#careDivId").html("<div style='text-align: center;font-size: 18px'>商品信息为空,<a href='index.html'>选购</a></div>");
                }
            }
        })
    }
    function initcopy(){
        addCommmon=$("#addAddressDiv").html();
        updateCommmon=$("#updateAddressDiv").html();
    }
    /*新增*/
    var v_addAddress;
    function  addAddress(){
        v_addAddress=bootbox.dialog({
            title: '新增地址信息',
            message: $("#addAddressDiv form"),
            size: 'large',
             backdrop:false,
            buttons: {
                cancel: {
                    label: "<span class='glyphicon glyphicon-remove'>取消</span>" ,
                    className: 'btn-danger',
                    callback: function(){

                    }
                },
                ok: {
                    label: "<span class='glyphicon glyphicon-ok'>确定</span>",
                    className: 'btn-info',
                    callback: function(){
                        var v_vipName = $("#vipName",v_addAddress).val();
                        var v_addressee = $("#addressee",v_addAddress).val();
                        var v_addresseePhone = $("#addresseePhone",v_addAddress).val();
                        var v_addresseeName = $("#addresseeName",v_addAddress).val();
                        var v_areaId1=$($("select[name='areaName']",v_addAddress)[0]).val();
                        var v_areaId2=$($("select[name='areaName']",v_addAddress)[1]).val();
                        var v_areaId3=$($("select[name='areaName']",v_addAddress)[2]).val();
                        var v_param={};
                        v_param.vipName=v_vipName;
                        v_param.addresseePhone=v_addresseePhone;
                        v_param.addresseeName=v_addresseeName;
                        v_param.addressee=v_addressee;
                        v_param.sheng=v_areaId1;
                        v_param.shi=v_areaId2;
                        v_param.xian=v_areaId3;
                        $.post({
                            url:"http://localhost:8082/address.jhtml",
                            data:v_param,
                            success:function(result){
                                if(result.code==200){
                                    bootbox.alert("新增成功!", function(){
                                      location.reload();
                                    });
                                }
                            },
                        })
                    }
                }
            }
        });
        $("#addAddressDiv").html(addCommmon);
        initArea(0);
    }
    function  del(){
        alert("不允许删除");
    }
    /*编辑*/
    function editArea(obj){
        $(obj).parent().nextAll().remove();
        initUpdateArea(0);
        $("#update_area",v_updateAddress).html("<label  class='col-sm-1 control-label' >地区</label>" +
            "<button type='button' onclick='cancelArea()'  class='btn btn-default' ><i class='glyphicon glyphicon-pencil'></i>取消编辑</button>");
    }
    /*取消编辑*/
    function cancelArea(){
        $("#update_area",v_updateAddress).html("<label  class='col-sm-2 control-label' >地区</label>\n" +
            "</div>"+v_areaName+"<button type='button' onclick='editArea(this)'  class='btn btn-default' ><i class='glyphicon glyphicon-pencil'></i>编辑</button>");
    }
    var v_updateAddress;
    var v_areaName;
    function  update(addressId){
        $.post({
            url:"http://localhost:8082/address/toupdate.jhtml",
            data:{"addressId":addressId},
            success:function(result){
                if(result.code==200){
                    $("#update_vipName").val(result.data.vipName);
                    $("#update_addressee").val(result.data.addressee);
                    $("#update_addresseePhone").val(result.data.addresseePhone);
                    $("#update_addresseeName").val(result.data.addresseeName);
                    $("#update_defaultAddress").val(result.data.defaultAddress);
                    v_areaName=result.data.areaName;
                    $("#update_area").append(result.data.areaName+"<button type='button' onclick='editArea(this)'  class='btn btn-default' ><i class='glyphicon glyphicon-pencil'></i>编辑</button>");
                    v_updateAddress = bootbox.dialog({
                        title: '修改用户信息',
                        message: $("#updateAddressDiv form"),
                        size: 'large',
                        backdrop:false,
                        buttons: {
                            cancel: {
                                label: "<span class='glyphicon glyphicon-remove'>取消</span>" ,
                                className: 'btn-danger',
                                callback: function(){

                                }
                            },
                            ok: {
                                label: "<span class='glyphicon glyphicon-ok'>确定</span>",
                                className: 'btn-info',
                                callback: function(){
                                    var v_update_vipName=$("#update_vipName",v_updateAddress).val();
                                    var v_update_addressee=$("#update_addressee",v_updateAddress).val();
                                    var v_update_addresseePhone=$("#update_addresseePhone",v_updateAddress).val();
                                    var v_update_addresseeName=$("#update_addresseeName",v_updateAddress).val();
                                    var v_areaList=$($("select[name='areaName']",v_updateAddress));
                                    var v_area1;
                                    var v_area2;
                                    var v_area3;
                                    if(v_areaList.length==3){
                                        v_area1=$($("select[name='areaName']",v_updateAddress)[0]).val();
                                        v_area2=$($("select[name='areaName']",v_updateAddress)[1]).val();
                                        v_area3=$($("select[name='areaName']",v_updateAddress)[2]).val();
                                    }
                                    var v_param={};
                                    v_param.addressId=addressId;
                                    v_param.vipName=v_update_vipName;
                                    v_param.addressee=v_update_addressee;
                                    v_param.addresseePhone=v_update_addresseePhone;
                                    v_param.addresseeName=v_update_addresseeName;
                                    v_param.areaId1=v_area1;
                                    v_param.areaId2=v_area2;
                                    v_param.areaId3=v_area3;
                                    $.ajax({
                                        type:"PUT",
                                        url:"http://localhost:8082/address.jhtml",
                                        data:JSON.stringify(v_param),
                                        contentType:"application/json",
                                        success:function(Pk){
                                            if(Pk.code==200){
                                                bootbox.alert("修改成功!", function(){
                                                    location.reload();
                                                });
                                            }
                                        },
                                    })
                                }
                            }
                        }
                    });
                    $("#updateAddressDiv").html(updateCommmon);
                }
            },
        })
    }
    /*新增*/
    function initArea(id,obj){
        if(obj){
            $(obj).parent().nextAll().remove();
        }
        $.ajax({
            type:"get",
            url:"http://localhost:8082/areas/queryArea.jhtml",
            data:{"id":id},
            success:function(result){
                if(result.code==200){
                    var v_areaList = result.data;
                    if(v_areaList.length==0){
                        return;
                    }
                    var kong="<div class='col-sm-3'>" +
                        "<select class='form-control' name='areaName' onchange='initArea(this.value,this)'>" +
                        "<option value='-1'>请选择</option>"
                    for(var i=0;i<v_areaList.length;i++){
                        kong+="<option value='"+v_areaList[i].id+"'>"+v_areaList[i].areaName+"</option>";
                    }
                    $("#add_area",v_addAddress).append(kong);
                }
            },
        })
    }
    /*修改*/
    function initUpdateArea(id,obj){
        if(obj){
            $(obj).parent().nextAll().remove();
        }
        $.ajax({
            type:"get",
            url:"http://localhost:8082/areas/queryArea.jhtml",
            data:{"id":id},
            success:function(result){
                if(result.code==200){
                    var v_areaList = result.data;
                    if(v_areaList.length==0){
                        return;
                    }
                    var kong="<div class='col-sm-3'>" +
                        "<select class='form-control' name='areaName' onchange='initUpdateArea(this.value,this)'>" +
                        "<option value='-1'>请选择</option>"
                    for(var i=0;i<v_areaList.length;i++){
                        kong+="<option value='"+v_areaList[i].id+"'>"+v_areaList[i].areaName+"</option>";
                    }
                    $("#update_area",v_updateAddress).append(kong);
                }
            },
        })
    }
    /*地址的拼接*/
    function queryAddress(){
        $.ajax({
            type:"get",
            url:"http://localhost:8082/address.jhtml",
            success:function(result){
                if(result.code==200){
                    var v_list=result.data;
                   var v_addressDiv=$("#initAddressDiv").html();
                    var v_html="";
                    for(var i=0;i<v_list.length;i++){
                        var address=v_list[i];
                         v_html += v_addressDiv.replace(/##vipName##/g,address.vipName)
                            .replace(/##addresseePhone##/g,address.addresseePhone)
                            .replace(/##areaName##/g,address.areaName)
                            .replace(/##addressId##/g,address.addressId);
                    }
                    $("#addressDiv").html(v_html);
                    var v_right=$("#rightDiv").html();
                        var right= v_right.replace(/##areaName##/g,address.areaName)
                                 .replace(/##vipName##/g,address.vipName)
                                 .replace(/##addresseePhone##/g,address.addresseePhone);
                        $("#rightDlog").html(right);
                }

                $(function(){
                    $(".address").hover(function(){
                        $(this).addClass("address-hover");
                    },function(){
                        $(this).removeClass("address-hover");
                    });
                })
                $(function(){
                    $(".addr-item .name").click(function(){
                        $(this).toggleClass("selected").siblings().removeClass("selected");
                    });
                    $(".payType li").click(function(){
                        $(this).toggleClass("selected").siblings().removeClass("selected");
                    });
                })
            }
        })
    }
    $(function(){
        $(".address").hover(function(){
            $(this).addClass("address-hover");
        },function(){
            $(this).removeClass("address-hover");
        });
    })
    $(function(){
        $(".addr-item .name").click(function(){
            $(this).toggleClass("selected").siblings().removeClass("selected");
        });
        $(".payType li").click(function(){
            $(this).toggleClass("selected").siblings().removeClass("selected");
        });
    })
    var v_Token//创建token
    function  createToken() {
        $.ajax({
            type:"get",
            url:"http://localhost:8082/token.jhtml",
            success:function(result){
                if(result.code==200){
                    v_Token=result.data;
                }
            },
        })
    }
    /*库存不够的信息*/
    function submitPay(){
        var v_payType=$("input[name='payType']:checked").val();
        $.ajax({
            type:"post",
            url:"http://localhost:8082/orderes.jhtml",
            beforeSend:function(xhr){
                var v_cookie=$.cookie("x");
                xhr.setRequestHeader("x-auth",v_cookie);
                xhr.setRequestHeader("token",v_Token);
            },
            data:{"payType":v_payType},
            success:function(result){
                if(result.code==200){
                    var v_list=result.data;
                    if(v_list.length<=0){
                        location.href="/pay.html";
                    }else{
                        var v_html ="";
                        var v_cartId=$("#orderInfo").html();
                        for(var i=0;i<v_list.length;i++){
                            var cart=v_list[i];
                            v_html += v_cartId.replace(/##shopName##/g,cart.shopName)
                                .replace(/##price##/g,cart.price)
                                .replace(/##imgPaths##/g,cart.image)
                                .replace(/##subTotalPrice##/g,cart.subTotalPrice)
                                .replace(/##count##/g,cart.count);
                        }
                        bootbox.confirm({
                            message: v_html,
                            backdrop:false,
                            buttons: {
                                confirm: {
                                    label: '确定',
                                    className: 'btn-success',
                                },
                            },
                            callback: function (result) {
                                if (result == true) {
                                    location.href="/pay.html";
                                }
                            }
                        });
                    }
                }
            },
        })
    }
</script>
</body>
</html>